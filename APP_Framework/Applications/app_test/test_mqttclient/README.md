## 1. 简介

本代码实现了MQTT对服务器订阅主体并发送信息功能

## 2. 数据结构设计说明

### 2.1 MQTT数据结构定义

![image-20231007142702891](.\imgs\图片4.png)

### 2.2 数据解析与加密

![image-20231007143235579](.\imgs\图片5.png)

### 2.3 MQTT连接与订阅

![image-20231007143448685](.\imgs\图片6.png)

![image-20231007143607579](.\imgs\图片7.png)

## 3. 测试程序说明

MQTT基于TCP/IP协议，分为客户端与服务端。在本任务中，ARM终端作为客户端，与服务端连接并进行主题订阅。

以下代码设置了进行订阅时需要的Client ID、用户名、密码及订阅主题。

![image-20231007144555989](.\imgs\图片8.png)

客户端首先需要根据以上信息向服务端发起连接请求，验证用户名及密码

![image-20231007144710185](.\imgs\图片9.png)

随后进行主题订阅，接收服务端发布的消息

![image-20231007144823940](.\imgs\图片10.png)

在订阅过程中需要对获取的信息进行读取，同时每隔一段时间向服务端发送保持活性ping请求，以维持与服务端的连接

![image-20231007144921430](.\imgs\图片11.png)

## 4. 测试流程

测试流程为：

首先执行setip命令，设置设备ip地址

![图片2](.\imgs\图片2.png)

随后执行“MqttSocketRecvTest 服务器ip”命令，订阅主题，然后在服务器端发布消息如图所示

![图片1](.\imgs\pic1.png)

最终设备端接收到信息

![图片3](.\imgs\pic2.png)